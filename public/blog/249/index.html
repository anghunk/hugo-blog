<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>使用 wxt 框架开发浏览器扩展时遇到的问题解决方案 - JiaoYuan&#39;s blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="在使用 wxt 框架开发浏览器扩展的过程中，记录了关于隔离脚本与网站样式、配置文件等问题的解决方案。">

	

	
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	
	
	<link rel="stylesheet" href="/css/style.css">
	

	
	<link rel="dns-prefetch" href="https://api.github.com">

</head>
<body class="body">
	<div class="container container--outer">
		
	<div class="topbar">
		<a class="topbar__link" href="/" title="JiaoYuan&#39;s blog" rel="sidebar">
			<div class="topbar__item topbar__text">
					<div class="topbar__title">JiaoYuan&#39;s blog</div>
					<div class="topbar__tagline">思绪来得快去得也快，偶尔会在这里停留</div>
				</div>
		</a>
	</div>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 wxt 框架开发浏览器扩展时遇到的问题解决方案</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<time class="meta__text" datetime="2024-12-25T00:00:00Z">December 25, 2024</time></div></div>
		</header><div class="content post__content clearfix">
			<p>最近在使用 wxt 框架开发浏览器扩展，记录一些问题。</p>
<p><a href="https://wxt.dev/">https://wxt.dev/</a></p>
<h3 id="1-隔离脚本与网站本身的样式">1. 隔离脚本与网站本身的样式</h3>
<p>使用 <a href="https://wxt.dev/guide/essentials/content-scripts.html#shadow-root">Shadow Root</a>，可以不让 content-scripts 侵入式影响网站本身，然后引入并渲染 App.vue 组件。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;./style.css&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createApp</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;vue&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">App</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./App.vue&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">defineContentScript</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">matches</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;https://google.com/*&#39;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cssInjectionMode</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;ui&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">main</span>(<span style="color:#a6e22e">ctx</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ui</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">createShadowRootUi</span>(<span style="color:#a6e22e">ctx</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;example-ui&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;inline&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">anchor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;body&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">onMount</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">container</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createApp</span>(<span style="color:#a6e22e">App</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">mount</span>(<span style="color:#a6e22e">container</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">app</span>;
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">onRemove</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">app</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">app</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">unmount</span>();
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ui</span>.<span style="color:#a6e22e">mount</span>();
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="2-在-configjs-中配置">2. 在 config.js 中配置</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">defineConfig</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;wxt&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">pkg</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./package.json&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// See https://wxt.dev/api/config.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">defineConfig</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">extensionApi</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;chrome&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">modules</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;@wxt-dev/module-vue&#39;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">manifest</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;xxx&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pkg</span>.<span style="color:#a6e22e">version</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> ...,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">permissions</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;storage&#39;</span>, <span style="color:#e6db74">&#39;scripting&#39;</span>] <span style="color:#75715e">// 存储、插入脚本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">hooks</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;build:manifestGenerated&#39;</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">wxt</span>, <span style="color:#a6e22e">manifest</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">wxt</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">command</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;serve&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">manifest</span>.<span style="color:#a6e22e">content_scripts</span> <span style="color:#f92672">??=</span> [];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">manifest</span>.<span style="color:#a6e22e">content_scripts</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">matches</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;https://google.com/*&#39;</span>],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">js</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;content-scripts/content.js&#39;</span>],
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">css</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;content-scripts/content.css&#39;</span>]
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div>
		</div>
	</article>
</main>



			</div>
			
		</div>
	</div>
	
	<script src="/js/search.js" defer></script>
	<script src="/js/archives.js" defer></script>
	<script src="/js/lazyload.js" defer></script>
	
	
</body>
</html>